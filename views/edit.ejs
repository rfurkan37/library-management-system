<%- include('header', { title: 'Edit Book - Library Management System', currentPage: 'books' }) %>

<div class="content-wrapper" style="max-width: 800px;">
    <div style="padding: 2rem;">
        <!-- Header -->
        <div style="text-align: center; margin-bottom: 2rem;">
            <div style="background: linear-gradient(135deg, var(--warning-color), #f6ad55); width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                <i class="fas fa-edit" style="font-size: 2rem; color: white;"></i>
            </div>
            <h1 style="color: var(--gray-800); margin-bottom: 0.5rem;">Edit Book</h1>
            <p style="color: var(--gray-600); margin-bottom: 0.5rem;">
                <strong>"<%= book.title %>"</strong> by <%= book.author %>
            </p>
            <span style="font-family: monospace; background: var(--gray-200); padding: 0.2rem 0.4rem; border-radius: 4px; margin-top: 0.5rem; display: inline-block;">ISBN: <%= book.isbn %></span>
        </div>

        <!-- Edit Form -->
        <form action="/books/edit/<%= book.id %>?_method=PUT" method="POST" id="editBookForm" style="max-width: 600px; margin: 0 auto;">
            <!-- Title Field -->
            <div style="margin-bottom: 1.5rem;">
                <label for="title" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--gray-700);">
                    <i class="fas fa-book" style="margin-right: 0.5rem; color: var(--primary-color);"></i>
                    Book Title *
                </label>
                <input 
                    type="text" 
                    id="title" 
                    name="title" 
                    required
                    style="width: 100%; padding: 0.75rem 1rem; border: 2px solid var(--gray-300); border-radius: 8px; font-size: 1rem; transition: var(--transition);"
                    value="<%= book.title %>"
                    placeholder="Enter book title"
                >
                <div class="field-progress" data-field="title">
                    <div class="progress-bar"></div>
                </div>
            </div>

            <!-- Author Field -->
            <div style="margin-bottom: 1.5rem;">
                <label for="author" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--gray-700);">
                    <i class="fas fa-user" style="margin-right: 0.5rem; color: var(--primary-color);"></i>
                    Author *
                </label>
                <input 
                    type="text" 
                    id="author" 
                    name="author" 
                    required
                    style="width: 100%; padding: 0.75rem 1rem; border: 2px solid var(--gray-300); border-radius: 8px; font-size: 1rem; transition: var(--transition);"
                    value="<%= book.author %>"
                    placeholder="Enter author name"
                >
                <div class="field-progress" data-field="author">
                    <div class="progress-bar"></div>
                </div>
            </div>

            <!-- ISBN Field -->
            <div style="margin-bottom: 1.5rem;">
                <label for="isbn" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--gray-700);">
                    <i class="fas fa-barcode" style="margin-right: 0.5rem; color: var(--primary-color);"></i>
                    ISBN *
                </label>
                <input 
                    type="text" 
                    id="isbn" 
                    name="isbn" 
                    required
                    style="width: 100%; padding: 0.75rem 1rem; border: 2px solid var(--gray-300); border-radius: 8px; font-size: 1rem; transition: var(--transition); font-family: monospace;"
                    value="<%= book.isbn %>"
                    placeholder="978-0-123456-78-9"
                >
                <div class="field-progress" data-field="isbn">
                    <div class="progress-bar"></div>
                </div>
                <small style="color: var(--gray-600); margin-top: 0.25rem; display: block;">
                    <i class="fas fa-info-circle"></i>
                    Enter ISBN-10 or ISBN-13 format
                </small>
            </div>

            <!-- Quantity Field -->
            <div style="margin-bottom: 2rem;">
                <label for="quantity" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--gray-700);">
                    <i class="fas fa-hashtag" style="margin-right: 0.5rem; color: var(--primary-color);"></i>
                    Quantity
                </label>
                <input 
                    type="number" 
                    id="quantity" 
                    name="quantity" 
                    min="0"
                    style="width: 100%; padding: 0.75rem 1rem; border: 2px solid var(--gray-300); border-radius: 8px; font-size: 1rem; transition: var(--transition);"
                    value="<%= book.quantity || 0 %>"
                    placeholder="0"
                >
                <div class="field-progress" data-field="quantity">
                    <div class="progress-bar"></div>
                </div>
                <small style="color: var(--gray-600); margin-top: 0.25rem; display: block;">
                    <i class="fas fa-info-circle"></i>
                    Number of copies available in the library
                </small>
            </div>

            <!-- Form Actions -->
            <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
                <a href="/books" class="btn btn-secondary" style="padding: 1rem 2rem;">
                    <i class="fas fa-times"></i>
                    Cancel
                </a>
                <button type="submit" class="btn btn-primary" id="saveBtn" style="padding: 1rem 2rem;">
                    <i class="fas fa-save"></i>
                    Update Book
                </button>
            </div>

            <!-- Progress Indicator -->
            <div style="margin-top: 2rem; text-align: center;">
                <div style="background: var(--gray-200); height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 0.5rem;">
                    <div id="overallProgress" style="height: 100%; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); width: 100%; transition: var(--transition);"></div>
                </div>
                <small style="color: var(--gray-600);">
                    <i class="fas fa-check-circle" style="color: var(--success-color);"></i>
                    Form is complete and ready to submit
                </small>
            </div>
        </form>

        <!-- Book Information Panel -->
        <div style="margin-top: 3rem; padding: 1.5rem; background: var(--gray-100); border-radius: 12px; border-left: 4px solid var(--primary-color);">
            <h3 style="margin-bottom: 1rem; color: var(--gray-800); display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-info-circle"></i>
                Book Information
            </h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                <% if (book.createdAt) { %>
                    <div>
                        <span style="font-weight: 600; color: var(--gray-700);">Added:</span><br>
                        <small style="color: var(--gray-600);"><%= new Date(book.createdAt).toLocaleDateString() %></small>
                    </div>
                <% } %>
                <% if (book.updatedAt) { %>
                    <div>
                        <span style="font-weight: 600; color: var(--gray-700);">Last Updated:</span><br>
                        <small style="color: var(--gray-600);"><%= new Date(book.updatedAt).toLocaleDateString() %></small>
                    </div>
                <% } %>
            </div>
            
            <p style="margin: 0; color: var(--gray-600); font-size: 0.9rem;">
                <i class="fas fa-lightbulb" style="color: var(--warning-color);"></i>
                <strong>Tip:</strong> Make sure all information is accurate before saving. Changes will be reflected immediately in your library catalog.
            </p>
        </div>
    </div>
</div>

<style>
    .field-progress {
        height: 3px;
        background: var(--gray-200);
        border-radius: 2px;
        margin-top: 0.5rem;
        overflow: hidden;
    }

    .progress-bar {
        height: 100%;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        width: 0%;
        transition: var(--transition);
    }

    .field-progress[data-field="title"] .progress-bar,
    .field-progress[data-field="author"] .progress-bar,
    .field-progress[data-field="isbn"] .progress-bar,
    .field-progress[data-field="quantity"] .progress-bar {
        width: 100%;
    }

    #editBookForm input:focus {
        border-color: var(--primary-color);
        outline: none;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    #editBookForm input:valid {
        border-color: var(--success-color);
    }

    #editBookForm input:invalid:not(:focus) {
        border-color: var(--error-color);
    }

    .btn:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow-hover);
    }

    .btn:active {
        transform: translateY(0);
    }

    .loading {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid transparent;
        border-top: 2px solid currentColor;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    @media (max-width: 768px) {
        .content-wrapper {
            margin: 1rem;
        }
        
        #editBookForm {
            padding: 0 1rem;
        }
        
        .btn {
            width: 100%;
            margin-bottom: 0.5rem;
        }
        
        div[style*="display: flex"] {
            flex-direction: column;
        }
    }
</style>

<script>
    // Store original values for change detection
    const originalValues = {
        title: '<%= book.title %>',
        author: '<%= book.author %>',
        isbn: '<%= book.isbn %>',
        quantity: '<%= book.quantity || 0 %>'
    };

    function checkChanges() {
        const form = document.getElementById('editBookForm');
        const saveBtn = document.getElementById('saveBtn');
        const inputs = form.querySelectorAll('input');
        
        let hasChanges = false;
        
        inputs.forEach(input => {
            const fieldName = input.name;
            const currentValue = input.value.trim();
            const originalValue = originalValues[fieldName]?.toString() || '';
            
            if (currentValue !== originalValue) {
                hasChanges = true;
            }
        });
        
        if (hasChanges) {
            saveBtn.innerHTML = '<i class="fas fa-save"></i> Update Book';
            saveBtn.style.background = 'linear-gradient(135deg, var(--warning-color), #f6ad55)';
        } else {
            saveBtn.innerHTML = '<i class="fas fa-check"></i> No Changes';
            saveBtn.style.background = 'var(--gray-400)';
        }
    }

    // Add event listeners
    document.getElementById('editBookForm').addEventListener('input', checkChanges);
    document.getElementById('editBookForm').addEventListener('submit', function(e) {
        const saveBtn = document.getElementById('saveBtn');
        saveBtn.innerHTML = '<span class="loading"></span> Updating...';
        saveBtn.disabled = true;
    });
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        checkChanges();
    });
</script>

<%- include('footer') %>